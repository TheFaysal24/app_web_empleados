{% extends "base.html" %}
{% block title %}Ajustes de Cuenta{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ajustes.css') }}">
{% endblock %}

{% block content %}
<!-- Navegaci贸n Superior -->
<div class="top-nav">
  <a href="{{ url_for('dashboard') }}" class="btn btn-info">
    <i class="fas fa-arrow-left"></i> Volver al Dashboard
  </a>
  <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">
    <i class="fas fa-sign-out-alt"></i> Salir
  </a>
</div>

<div class="ajustes-container">
  <!-- Header -->
  <div class="ajustes-header">
    <h2>锔 Ajustes de Cuenta</h2>
    <p>Administra tu informaci贸n personal y seguridad</p>
  </div>

  <!-- Actualizar datos personales -->
  <div class="settings-section">
    <h4><i class="fas fa-user-edit"></i> Informaci贸n Personal</h4>

    <div class="info-box">
      <strong> Consejo:</strong> Mant茅n tu informaci贸n actualizada para que los registros sean precisos.
    </div>

    <!-- Ambos formularios apuntan a la misma ruta -->
    <form method="POST" action="{{ url_for('ajustes') }}">
      {{ update_form.hidden_tag() }}
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="nombre">Nombre Completo</label>
          <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Tu nombre completo" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="cargo">Cargo</label>
          <input type="text" class="form-control" id="cargo" name="cargo" placeholder="Tu cargo en la empresa" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="correo">Correo Electr贸nico</label>
          <input type="email" class="form-control" id="correo" name="correo" placeholder="tu.correo@empresa.com" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="telefono"> WhatsApp/Tel茅fono</label>
          <input type="text" class="form-control" id="telefono" name="telefono" placeholder="+57 300 123 4567">
        </div>
      </div>

      <!-- El 'name' y 'value' ayudan a identificar qu茅 formulario se envi贸 -->
      <button type="submit" name="submit_update" value="1" class="btn btn-primary">
        <i class="fas fa-save"></i> Guardar Cambios
      </button>
    </form>
  </div>

  <!-- Cambiar contrase帽a -->
  <div class="settings-section">
    <h4><i class="fas fa-lock"></i> Seguridad - Cambiar Contrase帽a</h4>

    <div class="info-box">
      <strong> Seguridad:</strong> Usa una contrase帽a fuerte con n煤meros, letras y caracteres especiales.
    </div>

    <!-- Ambos formularios apuntan a la misma ruta -->
    <form method="POST" action="{{ url_for('ajustes') }}">
      {{ password_form.hidden_tag() }}
      <div class="form-group">
        <label class="form-label" for="actual">Contrase帽a Actual</label>
        <input type="password" class="form-control" id="actual" name="actual" placeholder="Ingresa tu contrase帽a actual" required>
      </div>

      <div class="form-group">
        <label class="form-label" for="nueva">Nueva Contrase帽a</label>
        <input type="password" class="form-control" id="nueva" name="nueva" placeholder="Ingresa tu nueva contrase帽a" required>
      </div>

      <div class="form-group">
        <label class="form-label" for="confirmar">Confirmar Contrase帽a</label>
        <input type="password" class="form-control" id="confirmar" name="confirmar" placeholder="Confirma tu nueva contrase帽a" required>
      </div>

      <!-- El 'name' y 'value' ayudan a identificar qu茅 formulario se envi贸 -->
      <button type="submit" name="submit_password" value="1" class="btn btn-primary" onclick="return validarContrasenas()">
        <i class="fas fa-key"></i> Actualizar Contrase帽a
      </button>
    </form>
  </div>

  <!-- Informaci贸n de cuenta -->
  <div class="settings-section">
    <h4><i class="fas fa-info-circle"></i> Informaci贸n de tu Cuenta</h4>

    <div class="form-row">
      <div>
        <p><strong>Usuario:</strong> {{ session['usuario'] }}</p>
      </div>
      <div>
        <p><strong>Nombre:</strong> {{ session['nombre'] }}</p>
      </div>
    </div>

    <div class="account-footer">
      <p style="color: #999; font-size: 0.9em;">
        <i class="fas fa-clock"></i> ltima sesi贸n: <strong>Hoy</strong>
      </p>
    </div>
  </div>

</div>

<script>
  function validarContrasenas() {
    const nueva = document.getElementById('nueva').value;
    const confirmar = document.getElementById('confirmar').value;

    if (nueva !== confirmar) {
      alert('Las contrase帽as no coinciden. Por favor, verifica.');
      return false;
    }

    if (nueva.length < 6) {
      alert('La contrase帽a debe tener al menos 6 caracteres.');
      return false;
    }

    return true;
  }
</script>
{% endblock %}
