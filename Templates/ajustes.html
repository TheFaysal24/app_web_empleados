{% extends "base.html" %}
{% block title %}Ajustes de Cuenta{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/ajustes.css') }}">
{% endblock %}

{% block content %}
<div class="ajustes-container">
  <!-- Header -->
  <div class="ajustes-header">
    <h2><i class="fas fa-cog"></i> Ajustes de Cuenta</h2>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Volver al Dashboard
    </a>
  </div>

  <!-- Actualizar datos personales -->
  <div class="settings-section">
    <h4><i class="fas fa-user-edit"></i> Informaci√≥n Personal</h4>

    <div class="info-box">
      <strong>üí° Consejo:</strong> Mant√©n tu informaci√≥n actualizada para que los registros sean precisos.
    </div>

    <!-- Ambos formularios apuntan a la misma ruta -->
    <form method="POST" action="{{ url_for('ajustes') }}">
      {{ update_form.hidden_tag() }}
      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="nombre">Nombre</label>
          {{ update_form.nombre(class="form-control", placeholder="Tu nombre", value=current_user.nombre) }}
        </div>
        <div class="form-group">
          <label class="form-label" for="apellido">Apellido</label>
          {{ update_form.apellido(class="form-control", placeholder="Tu apellido", value=current_user.apellido) }}
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="correo">Correo Electr√≥nico</label>
          {{ update_form.correo(class="form-control", placeholder="tu.correo@empresa.com", value=current_user.correo) }}
        </div>
        <div class="form-group">
          <label class="form-label" for="telefono">Tel√©fono</label>
          {{ update_form.telefono(class="form-control", placeholder="+57 300 123 4567", value=current_user.telefono) }}
        </div>
      </div>

      <!-- El 'name' y 'value' ayudan a identificar qu√© formulario se envi√≥ -->
      <button type="submit" name="submit_update" value="1" class="btn btn-primary">
        <i class="fas fa-save"></i> Guardar Cambios
      </button>
    </form>
  </div>

  <!-- Cambiar contrase√±a -->
  <div class="settings-section">
    <h4><i class="fas fa-lock"></i> Seguridad - Cambiar Contrase√±a</h4>

    <div class="info-box">
      <strong>üîí Seguridad:</strong> Usa una contrase√±a fuerte con n√∫meros, letras y caracteres especiales.
    </div>

    <!-- Ambos formularios apuntan a la misma ruta -->
    <form method="POST" action="{{ url_for('ajustes') }}">
      {{ password_form.hidden_tag() }}
      <div class="form-group">
        <label class="form-label" for="actual">Contrase√±a Actual</label>
        {{ password_form.actual(class="form-control", placeholder="Ingresa tu contrase√±a actual") }}
      </div>

      <div class="form-group">
        <label class="form-label" for="nueva">Nueva Contrase√±a</label>
        {{ password_form.nueva(class="form-control", placeholder="M√≠nimo 6 caracteres") }}
      </div>

      <div class="form-group">
        <label class="form-label" for="confirmar">Confirmar Contrase√±a</label>
        {{ password_form.confirmar(class="form-control", placeholder="Repite la nueva contrase√±a") }}
      </div>

      <!-- El 'name' y 'value' ayudan a identificar qu√© formulario se envi√≥ en el backend -->
      <button type="submit" name="submit_password" value="1" class="btn btn-primary" onclick="return validarContrasenas()">
        <i class="fas fa-key"></i> Actualizar Contrase√±a
      </button>
    </form>
  </div>

  <!-- Informaci√≥n de cuenta -->
  <div class="settings-section">
    <h4><i class="fas fa-info-circle"></i> Informaci√≥n de tu Cuenta</h4>
    <div class="form-row account-info">
      <div>
        <p><strong>Usuario:</strong> {{ current_user.username }}</p>
      </div>
      <div>
        <p><strong>Rol:</strong> <span class="badge bg-primary">{{ current_user.cargo.capitalize() }}</span></p>
      </div>
    </div>

    <div class="account-footer">
      <p>
        <i class="fas fa-clock"></i> Miembro desde: <strong>{{ current_user.fecha_creacion.strftime('%d de %B de %Y') }}</strong>
      </p>
    </div>

    <div class="mt-4 text-center">
      <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</a>
    </div>
  </div>

</div>

<script>
  function validarContrasenas() {
    const nueva = document.getElementById('nueva_contrasena').value;
    const confirmar = document.getElementById('confirmar_contrasena').value;

    if (nueva !== confirmar) {
      alert('Las contrase√±as no coinciden. Por favor, verifica.');
      return false;
    }

    if (nueva.length < 6) {
      alert('La contrase√±a debe tener al menos 6 caracteres.');
      return false;
    }

    return true;
  }
</script>
{% endblock %}
