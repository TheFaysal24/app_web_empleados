{% extends "base.html" %}
{% block title %}Asignar Turnos{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_asignar_turnos.css') }}">
{% endblock %}

{% block content %}
<div class="turnos-container">

  <!-- Navegación Superior -->
  <div class="top-nav">
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Volver al Dashboard
    </a>
    <h2 class="page-title">Asignación de Turnos</h2>
    <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">
      <i class="fas fa-sign-out-alt"></i> Salir
    </a>
  </div>

  <!-- Formulario principal -->
  <form method="POST">
    {{ form.hidden_tag() }}

    <div class="card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="fas fa-calendar-plus"></i> Planificación Semanal
        </h3>
        <p class="card-subtitle">
          Selecciona el turno para cada gestor y día. Los cambios se aplicarán para la semana actual.
        </p>
      </div>

      <div class="table-responsive">
        <table class="table table-turnos">
          <thead>
            <tr>
              <th>Usuario</th>
              <th>Lunes</th>
              <th>Martes</th>
              <th>Miércoles</th>
              <th>Jueves</th>
              <th>Viernes</th>
              <th>Sábado</th>
              <th>Domingo</th>
            </tr>
          </thead>
          <tbody>
            {% for usuario, turnos in usuarios_turnos.items() %}
            <tr>
              <td class="user-cell">
                <i class="fas fa-user"></i> {{ usuario }}
              </td>
              {% for dia in ['lunes', 'martes', 'miercoles', 'jueves', 'viernes', 'sabado', 'domingo'] %}
              <td>
                <div class="form-group-table">
                  <select name="{{ usuario }}_{{ dia }}" class="form-control form-control-sm">
                    {% set turno_actual = turnos.get(dia, 'Descanso') %}
                    {% for opcion in form.opciones_turno %}
                      <option value="{{ opcion }}" {% if opcion == turno_actual %}selected{% endif %}>
                        {{ opcion }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </td>
              {% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Botón de Guardar -->
    <div class="submit-container">
      <button type="submit" class="btn btn-primary btn-lg">
        <i class="fas fa-save"></i> Guardar Cambios
      </button>
    </div>
  </form>
</div>
{% endblock %}